<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: html-to-html-snippets.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: html-to-html-snippets.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>module.exports = htmlToHtmlSnippets

var cheerio = require('cheerio')
var Attr = require('./attr')
var COMMENT_NODE_TYPE = 8

/**
 * convert one html string to several html snippets
 *
 * @example
 * // from:
 * &lt;div data-component-name="ComponentA">
 *   &lt;div data-component-name="ComponentB">
 *   &lt;/div>
 * &lt;/div>
 * // to:
 * &lt;div>&lt;div data-component-name="ComponentB">&lt;/div>&lt;/div>
 * &lt;div data-component-name="ComponentB">&lt;/div>
 *
 * @param {String} html
 * @return {Object.&lt;string, Component>}
 */

function htmlToHtmlSnippets (html) {
  var $ = cheerio.load(html, { normalizeWhitespace: true })

  var htmlSnippets = {}

  $('[data-component-name]').each(function () {
    // get all annotated attributes
    var $element = $(this).clone()

    var component = new Attr($element).extract()
    var componentName = component.name

    // check component name , make sure it is camelcase
    if (!componentName) {
      throw new Error(
        'this component does not have a name: \n' +
        $(this).toString()
      )
    } else if (!isUpperCamelCase(componentName)) {
      throw new Error(
        'this component name "' +
        componentName +
        '" is not upper camel case: \n' +
        $(this).toString()
      )
    }

    // only override an existing component if the current is primary
    var isPrimary = component.primary
    var skipCurrentComponent = htmlSnippets[componentName] &amp;&amp; !isPrimary
    if (skipCurrentComponent) {
      return
    }

    // remove comment, script and style
    component.removedComments = []
    component.removedScriptTags = []
    component.removedStyleTags = []
    $element
      .contents()
      .filter(function () {
        if (this.nodeType === COMMENT_NODE_TYPE) {
          component.removedComments.push($(this).toString())
          return true
        } else if ($(this).get(0).tagName === 'script') {
          component.removedScriptTags.push($(this).toString())
          return true
        } else if ($(this).get(0).tagName === 'style') {
          component.removedStyleTags.push($(this).toString())
          return true
        }
      })
      .remove()

    // convert element to string snippet
    component.htmlSnippet = $element.toString()

    // insert into htmlSnippets object
    htmlSnippets[componentName] = component
  })

  return htmlSnippets
}

function isUpperCamelCase (string) {
  return !/[-_]/.test(string) &amp;&amp; string[0] === string[0].toUpperCase()
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addDeclaration">addDeclaration</a></li><li><a href="global.html#addImportAndExport">addImportAndExport</a></li><li><a href="global.html#formatFileSnippet">formatFileSnippet</a></li><li><a href="global.html#htmlSnippetToJsxSnippet">htmlSnippetToJsxSnippet</a></li><li><a href="global.html#htmlToHtmlSnippets">htmlToHtmlSnippets</a></li><li><a href="global.html#htmlToReact">htmlToReact</a></li><li><a href="global.html#reacterminator">reacterminator</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Mon Mar 28 2016 17:04:26 GMT-0500 (CDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
